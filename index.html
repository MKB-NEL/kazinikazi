<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
  <title>Kazi ni Kazi - Rwanda's Job Marketplace</title>
  
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* ===== MODERN RESET & VARIABLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --primary: #FF385C;
      --primary-light: #FF6B8B;
      --primary-dark: #E31C5F;
      --secondary: #00A699;
      --success: #27ae60;
      --warning: #f39c12;
      --gray-50: #F9F9F9;
      --gray-100: #F7F7F7;
      --gray-200: #EBEBEB;
      --gray-300: #DDDDDD;
      --gray-400: #B0B0B0;
      --gray-500: #717171;
      --gray-600: #5E5E5E;
      --gray-700: #222222;
      --shadow-xs: 0 2px 4px rgba(0,0,0,0.02);
      --shadow-sm: 0 6px 16px rgba(0,0,0,0.08);
      --shadow-md: 0 12px 24px rgba(0,0,0,0.12);
      --shadow-lg: 0 24px 48px rgba(0,0,0,0.16);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      --transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--gray-700);
      background: white;
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== STICKY HEADER ===== */
    .sticky-header {
      position: sticky;
      top: 0;
      background: rgba(255,255,255,0.96);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 100;
      border-bottom: 1px solid var(--gray-200);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      cursor: pointer;
    }
    .logo span {
      color: var(--gray-700);
    }
    .logo i {
      font-size: 1.8rem;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    /* ===== BUTTONS ===== */
    .btn-icon {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-full);
      background: white;
      border: 1px solid var(--gray-300);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: var(--gray-700);
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-xs);
    }
    .btn-icon:active {
      transform: scale(0.96);
      background: var(--gray-100);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-full);
      padding: 14px 28px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
      width: 100%;
    }
    .btn-primary:active {
      transform: scale(0.98);
      background: var(--primary-dark);
      box-shadow: var(--shadow-md);
    }

    .btn-outline {
      background: white;
      border: 1.5px solid var(--gray-300);
      border-radius: var(--radius-full);
      padding: 14px 28px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
    }
    .btn-outline:active {
      background: var(--gray-100);
      transform: scale(0.98);
    }

    /* ===== MAIN CONTAINER ===== */
    .container {
      flex: 1;
      padding: 16px 20px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    /* ===== ACCOUNT SELECTION MODAL ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
    }

    .modal-card {
      background: white;
      border-radius: var(--radius-xl);
      max-width: 480px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      padding: 24px 24px 16px;
      border-bottom: 1px solid var(--gray-200);
    }
    .modal-header h2 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .modal-header p {
      color: var(--gray-500);
      font-size: 1rem;
    }

    .modal-body {
      padding: 24px;
    }

    /* ===== ACCOUNT TYPE CARDS ===== */
    .account-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .account-card {
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-lg);
      padding: 20px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }
    .account-card:hover {
      border-color: var(--primary-light);
    }
    .account-card.selected {
      border-color: var(--primary);
      background: rgba(255,56,92,0.02);
    }
    .account-card.selected::before {
      content: 'âœ“';
      position: absolute;
      top: 16px;
      right: 16px;
      color: var(--primary);
      font-weight: 700;
      font-size: 1.2rem;
    }

    .account-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-full);
      background: var(--gray-100);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 12px;
    }

    .account-title {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 4px;
    }
    .account-desc {
      color: var(--gray-500);
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .account-badge {
      display: inline-block;
      background: var(--gray-100);
      padding: 4px 12px;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      margin-top: 12px;
      color: var(--gray-600);
    }

    /* ===== SEARCH SECTION ===== */
    .search-section {
      margin: 16px 0 32px;
    }
    .search-tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 12px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .search-tabs::-webkit-scrollbar {
      display: none;
    }
    .search-tab {
      padding: 10px 24px;
      border-radius: var(--radius-full);
      background: var(--gray-100);
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      transition: var(--transition);
    }
    .search-tab.active {
      background: var(--gray-700);
      color: white;
    }

    .search-bar {
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-xl);
      padding: 8px;
      box-shadow: var(--shadow-sm);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    @media (min-width: 640px) {
      .search-bar {
        flex-direction: row;
        align-items: center;
        padding: 4px 4px 4px 16px;
      }
    }
    .search-input {
      flex: 1;
      padding: 8px;
    }
    .search-input label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--gray-500);
      display: block;
      margin-bottom: 2px;
    }
    .search-input select, .search-input input {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      font-size: 0.95rem;
      color: var(--gray-700);
      font-weight: 500;
    }
    .search-btn {
      background: var(--primary);
      border: none;
      border-radius: var(--radius-full);
      padding: 14px 24px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .search-btn:active {
      background: var(--primary-dark);
      transform: scale(0.98);
    }

    /* ===== CARD GRID ===== */
    .section-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin: 32px 0 20px;
      letter-spacing: -0.02em;
    }

    .card-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 40px;
    }
    @media (min-width: 480px) {
      .card-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (min-width: 768px) {
      .card-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    @media (min-width: 1024px) {
      .card-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .card {
      background: white;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      cursor: pointer;
      border: 1px solid var(--gray-200);
    }
    .card:active {
      transform: scale(0.98);
      box-shadow: var(--shadow-md);
    }

    .card-image {
      aspect-ratio: 1/1;
      position: relative;
      background: var(--gray-100);
    }
    .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .card-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: white;
      padding: 4px 12px;
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .card-verified {
      color: var(--primary);
    }

    .card-content {
      padding: 16px;
    }
    .card-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
    }
    .card-subtitle {
      color: var(--gray-500);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
    }
    .card-rating {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 500;
    }
    .card-rating i {
      color: var(--primary);
    }
    .card-status {
      font-size: 0.85rem;
      padding: 4px 12px;
      border-radius: var(--radius-full);
      background: var(--gray-100);
      font-weight: 500;
    }
    .status-available { background: #e8f5e9; color: #2e7d32; }
    .status-working { background: #fff3e0; color: #ef6c00; }
    .status-unavailable { background: #ffebee; color: #c62828; }

    /* ===== PROFILE HEADER ===== */
    .profile-header {
      background: white;
      border-radius: var(--radius-xl);
      padding: 24px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    @media (min-width: 640px) {
      .profile-header {
        flex-direction: row;
        align-items: center;
      }
    }
    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid white;
      box-shadow: var(--shadow-md);
    }
    .profile-info {
      flex: 1;
    }
    .profile-name {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }
    .profile-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      color: var(--gray-500);
      margin-bottom: 16px;
    }
    .profile-meta span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .profile-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .profile-actions button, .profile-actions select {
      flex: 1;
      min-width: 140px;
    }

    /* ===== FLOATING ACTION BUTTON ===== */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--primary);
      color: white;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      transition: var(--transition);
      z-index: 90;
      border: none;
    }
    .fab:active {
      transform: scale(0.9);
      background: var(--primary-dark);
    }

    /* ===== TOAST NOTIFICATION ===== */
    .toast-container {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      width: 90%;
      max-width: 400px;
      pointer-events: none;
    }
    .toast {
      background: var(--gray-700);
      color: white;
      padding: 16px 20px;
      border-radius: var(--radius-full);
      box-shadow: var(--shadow-lg);
      font-weight: 500;
      text-align: center;
      animation: toastIn 0.3s ease;
      margin-bottom: 8px;
    }
    @keyframes toastIn {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* ===== LOADING ===== */
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 40px auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ===== FOOTER ===== */
    .footer {
      background: var(--gray-700);
      color: white;
      padding: 48px 20px 24px;
      margin-top: 60px;
    }
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 32px;
    }
    .footer-section h4 {
      font-size: 1.1rem;
      margin-bottom: 20px;
      color: white;
    }
    .footer-section ul {
      list-style: none;
    }
    .footer-section li {
      margin-bottom: 12px;
    }
    .footer-section a {
      color: var(--gray-400);
      text-decoration: none;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .footer-section a:hover {
      color: white;
    }
    .footer-bottom {
      max-width: 1200px;
      margin: 40px auto 0;
      padding-top: 24px;
      border-top: 1px solid rgba(255,255,255,0.1);
      text-align: center;
      color: var(--gray-400);
      font-size: 0.9rem;
    }

    /* ===== UTILITY CLASSES ===== */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-4 { margin-top: 16px; }
    .mb-4 { margin-bottom: 16px; }
  </style>
</head>
<body>
  <!-- STICKY HEADER -->
  <header class="sticky-header">
    <div class="logo" onclick="navigateTo('home')">
      <i class="fas fa-briefcase"></i>
      <span>Kazi</span> ni Kazi
    </div>
    <div class="header-actions" id="headerActions">
      <button class="btn-icon" onclick="toggleSearch()"><i class="fas fa-sliders-h"></i></button>
      <button class="btn-icon" id="authBtn" onclick="showAuthModal()"><i class="fas fa-user"></i></button>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main id="app" class="container">
    <div class="spinner"></div>
  </main>

  <!-- FLOATING ACTION BUTTON -->
  <button id="fab" class="fab hidden" onclick="handleFabClick()">
    <i class="fas fa-phone"></i>
  </button>

  <!-- TOAST CONTAINER -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- ACCOUNT SELECTION MODAL -->
  <div id="accountModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2>Join Kazi ni Kazi</h2>
        <p>Choose how you want to use the platform</p>
      </div>
      <div class="modal-body">
        <div class="account-grid" id="accountTypeGrid">
          <!-- Worker Account -->
          <div class="account-card" onclick="selectAccountType('worker')" id="account-worker">
            <div class="account-icon">
              <i class="fas fa-hard-hat"></i>
            </div>
            <div class="account-title">I'm a Worker</div>
            <div class="account-desc">Find jobs, showcase your skills, get hired by companies. Perfect for artisans, builders, cleaners, and skilled professionals.</div>
            <div class="account-badge">âœ“ Post portfolio â€¢ Set availability â€¢ Get reviewed</div>
          </div>
          
          <!-- Company Account -->
          <div class="account-card" onclick="selectAccountType('company')" id="account-company">
            <div class="account-icon">
              <i class="fas fa-building"></i>
            </div>
            <div class="account-title">I'm a Company</div>
            <div class="account-desc">Hire workers, post jobs, build your team. Ideal for construction firms, cleaning services, and local businesses.</div>
            <div class="account-badge">âœ“ Post jobs â€¢ Find talent â€¢ Build reputation</div>
          </div>
          
          <!-- User Account -->
          <div class="account-card" onclick="selectAccountType('user')" id="account-user">
            <div class="account-icon">
              <i class="fas fa-user"></i>
            </div>
            <div class="account-title">I'm a User</div>
            <div class="account-desc">Browse and hire workers or companies for personal projects. Great for homeowners and individuals.</div>
            <div class="account-badge">âœ“ Browse only â€¢ Leave reviews â€¢ Contact directly</div>
          </div>
        </div>
        
        <button class="btn-primary" onclick="proceedWithAccount()" id="proceedBtn" disabled>Select an account to continue</button>
        <button class="btn-outline mt-4" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- AUTH FORM MODAL -->
  <div id="authModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="authModalTitle">Create your account</h2>
        <p id="authModalSubtitle">Sign up as a <span id="selectedRoleDisplay">Worker</span></p>
      </div>
      <div class="modal-body">
        <div id="authError" style="color: var(--primary); margin-bottom: 16px; text-align: center;"></div>
        <form id="authForm" onsubmit="handleAuthSubmit(event)">
          <div class="form-group" style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">Full Name / Company Name</label>
            <input type="text" class="form-control" id="fullName" placeholder="Enter your name" style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);">
          </div>
          
          <div class="form-group" style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">Email</label>
            <input type="email" class="form-control" id="email" placeholder="your@email.com" required style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);">
          </div>
          
          <div class="form-group" style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">Password</label>
            <input type="password" class="form-control" id="password" placeholder="At least 6 characters" required style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);">
          </div>
          
          <div class="form-group" style="margin-bottom: 16px;" id="uniqueNameGroup">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">Choose a unique username</label>
            <input type="text" class="form-control" id="uniqueName" placeholder="@username (one per device)" style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);">
            <small style="color: var(--gray-500);">This cannot be changed later</small>
          </div>
          
          <button type="submit" class="btn-primary" style="margin-top: 8px;">Create Account</button>
        </form>
        <p class="text-center mt-4">
          Already have an account? <a href="#" onclick="switchToLogin()" style="color: var(--primary); font-weight: 600;">Sign In</a>
        </p>
        <button class="btn-outline mt-4" onclick="closeModal('authModal')">Close</button>
      </div>
    </div>
  </div>

  <!-- POST JOB MODAL -->
  <div id="jobModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2>Post a Job</h2>
        <p>Find the right worker for your task</p>
      </div>
      <div class="modal-body">
        <form id="jobForm" onsubmit="postJob(event)">
          <div class="form-group" style="margin-bottom: 16px;">
            <label>Job Title</label>
            <input type="text" id="jobTitle" class="form-control" required style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);">
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label>Description</label>
            <textarea id="jobDesc" class="form-control" rows="3" required style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);"></textarea>
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label>Category</label>
            <select id="jobCategory" class="form-control" required style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);"></select>
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label>District</label>
            <select id="jobDistrict" class="form-control" required style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);"></select>
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label>Budget (RWF)</label>
            <input type="number" id="jobBudget" class="form-control" style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md);">
          </div>
          <button type="submit" class="btn-primary">Post Job</button>
        </form>
      </div>
    </div>
  </div>

  <!-- REVIEW MODAL -->
  <div id="reviewModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2>Leave a Review</h2>
        <p>Rate your experience (1-6 stars)</p>
      </div>
      <div class="modal-body">
        <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; font-size: 2rem; color: var(--gray-400);">
          <i class="far fa-star" onclick="setRating(1)"></i>
          <i class="far fa-star" onclick="setRating(2)"></i>
          <i class="far fa-star" onclick="setRating(3)"></i>
          <i class="far fa-star" onclick="setRating(4)"></i>
          <i class="far fa-star" onclick="setRating(5)"></i>
          <i class="far fa-star" onclick="setRating(6)"></i>
        </div>
        <textarea id="reviewText" class="form-control" rows="3" placeholder="Write your review..." style="width: 100%; padding: 14px; border: 1.5px solid var(--gray-300); border-radius: var(--radius-md); margin-bottom: 16px;"></textarea>
        <button class="btn-primary" onclick="submitReview()">Submit Review</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h4>About Kazi ni Kazi</h4>
        <ul>
          <li><a href="#"><i class="fas fa-info-circle"></i> How it works</a></li>
          <li><a href="#"><i class="fas fa-shield-alt"></i> Trust & safety</a></li>
          <li><a href="#"><i class="fas fa-blog"></i> Blog</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>For Workers</h4>
        <ul>
          <li><a href="#"><i class="fas fa-search"></i> Find jobs</a></li>
          <li><a href="#"><i class="fas fa-star"></i> Worker success</a></li>
          <li><a href="#"><i class="fas fa-chart-line"></i> Boost profile</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>For Companies</h4>
        <ul>
          <li><a href="#"><i class="fas fa-users"></i> Hire workers</a></li>
          <li><a href="#"><i class="fas fa-building"></i> Company dashboard</a></li>
          <li><a href="#"><i class="fas fa-bullhorn"></i> Post a job</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Support</h4>
        <ul>
          <li><a href="#"><i class="fas fa-question-circle"></i> Help center</a></li>
          <li><a href="#"><i class="fas fa-phone-alt"></i> Contact us</a></li>
          <li><a href="#"><i class="fas fa-gavel"></i> Terms & privacy</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Kazi ni Kazi. Empowering Rwanda's workforce.</p>
      <p style="margin-top: 12px; font-size: 0.8rem;">Made with <i class="fas fa-heart" style="color: var(--primary);"></i> in Kigali</p>
    </div>
  </footer>

  <script type="module">
    // -------------------- FIREBASE IMPORT --------------------
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, where, updateDoc, deleteDoc, addDoc, onSnapshot, orderBy, limit } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js';

    // -------------------- FIREBASE CONFIG --------------------
    const firebaseConfig = {
      apiKey: "AIzaSyAtHa9wAryji3EdWwhxT7tUwZquRD-LJvI",
      authDomain: "project-k-dbaef.firebaseapp.com",
      projectId: "project-k-dbaef",
      storageBucket: "project-k-dbaef.firebasestorage.app",
      messagingSenderId: "356936578912",
      appId: "1:356936578912:web:056bdbf8625b33d79e1005",
      measurementId: "G-PXB6QYYV3Z"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ImgBB API Key
    const IMGBB_API_KEY = 'ba8023ca74166460c442e8e703d2a1b0';

    // -------------------- GLOBAL STATE --------------------
    window.currentUser = null;
    window.userRole = null;
    window.userData = null;
    window.currentProfileId = null;
    window.selectedAccountType = null;
    window.deviceId = localStorage.getItem('deviceId') || 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    localStorage.setItem('deviceId', window.deviceId);
    window.currentRating = 0;
    window.reviewTargetId = null;

    // -------------------- TOAST SYSTEM --------------------
    window.showToast = (message, type = 'info') => {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      if (type === 'success') toast.style.background = 'var(--success)';
      if (type === 'error') toast.style.background = 'var(--primary)';
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    };

    // -------------------- MODAL CONTROLS --------------------
    window.showModal = (id) => {
      document.getElementById(id).classList.remove('hidden');
    };
    window.closeModal = (id) => {
      document.getElementById(id).classList.add('hidden');
    };

    // -------------------- ACCOUNT SELECTION FLOW --------------------
    window.showAuthModal = () => {
      // Show account type selection first
      showModal('accountModal');
    };

    window.selectAccountType = (type) => {
      // Remove selected class from all
      document.querySelectorAll('.account-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      // Add selected class to chosen
      document.getElementById(`account-${type}`).classList.add('selected');
      window.selectedAccountType = type;
      
      // Enable proceed button
      const proceedBtn = document.getElementById('proceedBtn');
      proceedBtn.disabled = false;
      proceedBtn.textContent = `Continue as ${type.charAt(0).toUpperCase() + type.slice(1)}`;
    };

    window.proceedWithAccount = () => {
      if (!window.selectedAccountType) return;
      
      // Close account modal
      closeModal('accountModal');
      
      // Show auth modal with role info
      document.getElementById('selectedRoleDisplay').textContent = 
        window.selectedAccountType.charAt(0).toUpperCase() + window.selectedAccountType.slice(1);
      
      // Hide unique name field by default
      document.getElementById('uniqueNameGroup').style.display = 'none';
      
      // Show unique name only for users
      if (window.selectedAccountType === 'user') {
        document.getElementById('uniqueNameGroup').style.display = 'block';
      }
      
      showModal('authModal');
    };

    // -------------------- AUTH HANDLING --------------------
    window.handleAuthSubmit = async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const fullName = document.getElementById('fullName').value;
      const uniqueName = document.getElementById('uniqueName')?.value;
      
      if (!email || !password) {
        showToast('Please fill all fields', 'error');
        return;
      }
      
      if (!window.selectedAccountType) {
        showToast('Please select account type', 'error');
        return;
      }
      
      try {
        // Create user in Firebase Auth
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        
        // Prepare user data
        const userData = {
          uid: userCred.user.uid,
          email,
          role: window.selectedAccountType,
          deviceId: window.deviceId,
          createdAt: new Date().toISOString(),
          verified: false,
          boosted: false,
          avgRating: 0,
          reviewCount: 0,
          followerCount: 0
        };
        
        // Add role-specific fields
        if (window.selectedAccountType === 'company') {
          userData.companyName = fullName;
          userData.phone = '';
          userData.district = '';
          userData.logo = '';
          userData.images = [];
        } else if (window.selectedAccountType === 'worker') {
          userData.fullName = fullName;
          userData.phone = '';
          userData.district = '';
          userData.jobCategory = '';
          userData.status = 'Available';
          userData.profilePicture = '';
          userData.portfolioImages = [];
        } else {
          // User account
          if (!uniqueName) {
            showToast('Unique name required for users', 'error');
            return;
          }
          
          // Check if unique name exists
          const q = query(collection(db, 'users'), where('uniqueName', '==', uniqueName));
          const snap = await getDocs(q);
          if (!snap.empty) {
            showToast('Username already taken', 'error');
            return;
          }
          
          userData.uniqueName = uniqueName;
        }
        
        // Save to Firestore
        await setDoc(doc(db, 'users', userCred.user.uid), userData);
        
        showToast('Account created successfully!', 'success');
        closeModal('authModal');
        
      } catch (error) {
        console.error('Auth error:', error);
        document.getElementById('authError').textContent = error.message;
      }
    };

    // Switch to login mode
    window.switchToLogin = () => {
      closeModal('authModal');
      // Implement login logic
      showToast('Login feature coming soon', 'info');
    };

    // -------------------- NAVIGATION --------------------
    window.navigateTo = async (page, id = null) => {
      if (id) window.currentProfileId = id;
      
      const app = document.getElementById('app');
      app.innerHTML = '<div class="spinner"></div>';
      
      if (!auth.currentUser) {
        await renderBrowse(app);
      } else {
        const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
        if (!userDoc.exists()) {
          await signOut(auth);
          return;
        }
        
        window.userData = userDoc.data();
        window.userRole = userDoc.data().role;
        
        if (page === 'profile' && id) {
          await renderProfile(app, id);
        } else {
          await renderDashboard(app);
        }
      }
    };

    // -------------------- RENDER FUNCTIONS --------------------
    async function renderBrowse(container) {
      try {
        // Fetch workers and companies
        const workersSnap = await getDocs(query(collection(db, 'users'), where('role', '==', 'worker'), limit(8)));
        const companiesSnap = await getDocs(query(collection(db, 'users'), where('role', '==', 'company'), limit(8)));
        
        // Load districts for filter
        const districtsSnap = await getDocs(collection(db, 'districts'));
        const categoriesSnap = await getDocs(collection(db, 'categories'));
        
        let html = `
          <div class="search-section">
            <div class="search-tabs">
              <div class="search-tab active" onclick="filterBrowse('workers')">Workers</div>
              <div class="search-tab" onclick="filterBrowse('companies')">Companies</div>
              <div class="search-tab" onclick="filterBrowse('jobs')">Jobs</div>
            </div>
            <div class="search-bar">
              <div class="search-input">
                <label>DISTRICT</label>
                <select id="filterDistrict">
                  <option value="">All Rwanda</option>
        `;
        
        districtsSnap.forEach(doc => {
          html += `<option value="${doc.id}">${doc.data().name || doc.id}</option>`;
        });
        
        html += `
                </select>
              </div>
              <div class="search-input">
                <label>CATEGORY</label>
                <select id="filterCategory">
                  <option value="">All Categories</option>
        `;
        
        categoriesSnap.forEach(doc => {
          html += `<option value="${doc.id}">${doc.data().name || doc.id}</option>`;
        });
        
        html += `
                </select>
              </div>
              <button class="search-btn" onclick="applyFilters()">
                <i class="fas fa-search"></i> Search
              </button>
            </div>
          </div>
          
          <h2 class="section-title">Available Workers</h2>
          <div class="card-grid">
        `;
        
        // Workers cards
        workersSnap.forEach(doc => {
          const w = doc.data();
          html += `
            <div class="card" onclick="navigateTo('profile', '${doc.id}')">
              <div class="card-image">
                <img src="${w.profilePicture || 'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=400'}" alt="${w.fullName || 'Worker'}">
                ${w.verified ? '<span class="card-badge"><i class="fas fa-check-circle card-verified"></i> Verified</span>' : ''}
              </div>
              <div class="card-content">
                <div class="card-title">
                  ${w.fullName || 'Worker'}
                  ${w.boosted ? '<i class="fas fa-bolt" style="color: var(--warning);"></i>' : ''}
                </div>
                <div class="card-subtitle">${w.jobCategory || 'General'} â€¢ ${w.district || 'Kigali'}</div>
                <div class="card-footer">
                  <span class="card-rating">
                    <i class="fas fa-star"></i> ${w.avgRating ? w.avgRating.toFixed(1) : '5.0'}
                  </span>
                  <span class="card-status status-${w.status === 'Available' ? 'available' : w.status === 'Working' ? 'working' : 'unavailable'}">
                    ${w.status || 'Available'}
                  </span>
                </div>
              </div>
            </div>
          `;
        });
        
        html += `</div><h2 class="section-title">Trusted Companies</h2><div class="card-grid">`;
        
        // Company cards
        companiesSnap.forEach(doc => {
          const c = doc.data();
          html += `
            <div class="card" onclick="navigateTo('profile', '${doc.id}')">
              <div class="card-image">
                <img src="${c.logo || 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=400'}" alt="${c.companyName || 'Company'}">
                ${c.verified ? '<span class="card-badge"><i class="fas fa-check-circle card-verified"></i> Verified</span>' : ''}
              </div>
              <div class="card-content">
                <div class="card-title">
                  ${c.companyName || 'Company'}
                  ${c.boosted ? '<i class="fas fa-bolt" style="color: var(--warning);"></i>' : ''}
                </div>
                <div class="card-subtitle">${c.district || 'Kigali'}</div>
                <div class="card-footer">
                  <span class="card-rating">
                    <i class="fas fa-star"></i> ${c.avgRating ? c.avgRating.toFixed(1) : '4.8'}
                  </span>
                  <span>${c.jobCount || 0} jobs</span>
                </div>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        container.innerHTML = html;
        
      } catch (error) {
        console.error('Render error:', error);
        container.innerHTML = '<p style="text-align: center;">Error loading content</p>';
      }
    }

    async function renderDashboard(container) {
      if (!window.userData) return;
      
      let html = '';
      
      if (window.userRole === 'company') {
        html = `
          <div class="profile-header">
            <img src="${window.userData.logo || 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=200'}" class="profile-avatar">
            <div class="profile-info">
              <div class="profile-name">${window.userData.companyName}</div>
              <div class="profile-meta">
                <span><i class="fas fa-map-marker-alt"></i> ${window.userData.district || 'Set location'}</span>
                <span><i class="fas fa-phone"></i> ${window.userData.phone || 'Add phone'}</span>
                <span><i class="fas fa-star"></i> ${window.userData.avgRating?.toFixed(1) || '0.0'}</span>
              </div>
              <div class="profile-actions">
                <button class="btn-primary" onclick="showModal('jobModal')">
                  <i class="fas fa-plus"></i> Post Job
                </button>
                <button class="btn-outline" onclick="editProfile()">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn-outline" onclick="boostProfile()">
                  <i class="fas fa-bolt"></i> Boost
                </button>
              </div>
            </div>
          </div>
          <h2 class="section-title">My Job Posts</h2>
          <div id="companyJobs" class="card-grid"></div>
        `;
        container.innerHTML = html;
        loadCompanyJobs();
        
      } else if (window.userRole === 'worker') {
        html = `
          <div class="profile-header">
            <img src="${window.userData.profilePicture || 'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=200'}" class="profile-avatar">
            <div class="profile-info">
              <div class="profile-name">${window.userData.fullName}</div>
              <div class="profile-meta">
                <span><i class="fas fa-briefcase"></i> ${window.userData.jobCategory || 'Set category'}</span>
                <span><i class="fas fa-map-marker-alt"></i> ${window.userData.district || 'Set district'}</span>
                <span><i class="fas fa-star"></i> ${window.userData.avgRating?.toFixed(1) || '0.0'}</span>
              </div>
              <div class="profile-actions">
                <select class="btn-outline" onchange="updateWorkerStatus(this.value)" style="padding: 14px;">
                  <option value="Available" ${window.userData.status === 'Available' ? 'selected' : ''}>ðŸŸ¢ Available</option>
                  <option value="Working" ${window.userData.status === 'Working' ? 'selected' : ''}>ðŸŸ¡ Working</option>
                  <option value="Not Available" ${window.userData.status === 'Not Available' ? 'selected' : ''}>ðŸ”´ Not Available</option>
                </select>
                <button class="btn-outline" onclick="editProfile()"><i class="fas fa-edit"></i> Edit</button>
                <button class="btn-outline" onclick="boostProfile()"><i class="fas fa-bolt"></i> Boost</button>
              </div>
            </div>
          </div>
          <h2 class="section-title">Available Jobs</h2>
          <div id="availableJobs" class="card-grid"></div>
        `;
        container.innerHTML = html;
        loadAvailableJobs();
        
      } else {
        // User account
        html = `
          <div class="profile-header">
            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200" class="profile-avatar">
            <div class="profile-info">
              <div class="profile-name">@${window.userData.uniqueName}</div>
              <div class="profile-meta">
                <span><i class="fas fa-eye"></i> Explorer Account</span>
                <span><i class="fas fa-calendar"></i> Joined ${new Date(window.userData.createdAt).toLocaleDateString()}</span>
              </div>
              <div class="profile-actions">
                <button class="btn-outline" onclick="editProfile()"><i class="fas fa-edit"></i> Edit</button>
              </div>
            </div>
          </div>
          <h2 class="section-title">Browse Workers & Companies</h2>
          <div class="card-grid" id="browseGrid"></div>
        `;
        container.innerHTML = html;
        loadBrowseForUser();
      }
      
      // Show/hide FAB
      if (window.currentProfileId && window.currentProfileId !== auth.currentUser?.uid) {
        document.getElementById('fab').classList.remove('hidden');
      } else {
        document.getElementById('fab').classList.add('hidden');
      }
    }

    async function renderProfile(container, userId) {
      try {
        const userDoc = await getDoc(doc(db, 'users', userId));
        if (!userDoc.exists()) return;
        
        const profile = userDoc.data();
        const isOwner = auth.currentUser?.uid === userId;
        
        // Load reviews
        const reviewsSnap = await getDocs(query(collection(db, 'reviews'), where('targetId', '==', userId), orderBy('createdAt', 'desc')));
        
        let html = `
          <div class="profile-header">
            <img src="${profile.profilePicture || profile.logo || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200'}" class="profile-avatar">
            <div class="profile-info">
              <div class="profile-name">
                ${profile.companyName || profile.fullName || '@' + profile.uniqueName}
                ${profile.verified ? '<i class="fas fa-check-circle" style="color: var(--primary); margin-left: 8px;"></i>' : ''}
              </div>
              <div class="profile-meta">
                ${profile.district ? `<span><i class="fas fa-map-marker-alt"></i> ${profile.district}</span>` : ''}
                ${profile.phone ? `<span><i class="fas fa-phone"></i> ${profile.phone}</span>` : ''}
                ${profile.email ? `<span><i class="fas fa-envelope"></i> ${profile.email}</span>` : ''}
              </div>
              <div class="profile-actions">
                ${!isOwner ? `<button class="btn-primary" onclick="toggleFollow('${userId}')"><i class="fas fa-user-plus"></i> Follow</button>` : ''}
                ${!isOwner ? `<button class="btn-outline" onclick="showReviewModal('${userId}')"><i class="fas fa-star"></i> Review</button>` : ''}
              </div>
            </div>
          </div>
          
          <h2 class="section-title">Reviews (${reviewsSnap.size})</h2>
          <div id="reviewsList" class="card-grid">
        `;
        
        if (reviewsSnap.empty) {
          html += '<p style="grid-column: 1/-1; text-align: center; color: var(--gray-500);">No reviews yet</p>';
        } else {
          reviewsSnap.forEach(doc => {
            const r = doc.data();
            html += `
              <div class="card" style="padding: 16px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                  <img src="${r.reviewerPhoto || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=50'}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                  <div>
                    <strong>${r.reviewerName || 'User'}</strong>
                    <div style="color: var(--primary);">
                      ${Array(r.rating).fill('<i class="fas fa-star"></i>').join('')}
                    </div>
                  </div>
                </div>
                <p>${r.comment || ''}</p>
              </div>
            `;
          });
        }
        
        html += '</div>';
        container.innerHTML = html;
        
        // Show FAB if not owner and phone exists
        if (!isOwner && profile.phone) {
          document.getElementById('fab').classList.remove('hidden');
          window.currentCallProfile = profile;
        }
        
      } catch (error) {
        console.error('Profile render error:', error);
      }
    }

    // -------------------- UTILITY FUNCTIONS --------------------
    window.filterBrowse = (type) => {
      showToast(`Showing ${type}`);
    };

    window.applyFilters = () => {
      showToast('Filters applied');
    };

    window.editProfile = () => {
      showToast('Edit profile coming soon');
    };

    window.boostProfile = () => {
      showToast('âœ¨ Profile boosted! (Demo feature)', 'success');
    };

    window.updateWorkerStatus = async (status) => {
      if (!auth.currentUser) return;
      await updateDoc(doc(db, 'users', auth.currentUser.uid), { status });
      showToast(`Status updated to ${status}`, 'success');
    };

    window.toggleFollow = async (userId) => {
      if (!auth.currentUser) {
        showToast('Please login first', 'error');
        return;
      }
      showToast('Followed! (Demo)');
    };

    window.showReviewModal = (userId) => {
      window.reviewTargetId = userId;
      window.currentRating = 0;
      showModal('reviewModal');
    };

    window.setRating = (rating) => {
      window.currentRating = rating;
      const stars = document.querySelectorAll('#reviewModal .fa-star');
      stars.forEach((star, index) => {
        if (index < rating) {
          star.classList.remove('far');
          star.classList.add('fas');
          star.style.color = 'var(--primary)';
        } else {
          star.classList.remove('fas');
          star.classList.add('far');
          star.style.color = '';
        }
      });
    };

    window.submitReview = async () => {
      if (!window.currentRating) {
        showToast('Please select a rating', 'error');
        return;
      }
      
      const comment = document.getElementById('reviewText').value;
      
      // Save review to Firestore
      if (auth.currentUser && window.reviewTargetId) {
        const reviewData = {
          targetId: window.reviewTargetId,
          reviewerId: auth.currentUser.uid,
          reviewerName: window.userData?.fullName || window.userData?.companyName || window.userData?.uniqueName,
          reviewerPhoto: window.userData?.profilePicture || window.userData?.logo,
          rating: window.currentRating,
          comment,
          createdAt: new Date().toISOString()
        };
        
        await addDoc(collection(db, 'reviews'), reviewData);
        showToast('Review submitted!', 'success');
        closeModal('reviewModal');
      }
    };

    window.handleFabClick = () => {
      if (window.currentCallProfile?.phone) {
        window.location.href = `tel:${window.currentCallProfile.phone}`;
      }
    };

    window.toggleSearch = () => {
      showToast('Search filters expanded');
    };

    // Load jobs (placeholder)
    async function loadCompanyJobs() {
      document.getElementById('companyJobs').innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No jobs posted yet</p>';
    }

    async function loadAvailableJobs() {
      document.getElementById('availableJobs').innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No jobs available</p>';
    }

    async function loadBrowseForUser() {
      const workersSnap = await getDocs(query(collection(db, 'users'), where('role', '==', 'worker'), limit(4)));
      let html = '';
      workersSnap.forEach(doc => {
        const w = doc.data();
        html += `
          <div class="card" onclick="navigateTo('profile', '${doc.id}')">
            <div class="card-image">
              <img src="${w.profilePicture || 'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=400'}">
            </div>
            <div class="card-content">
              <div class="card-title">${w.fullName || 'Worker'}</div>
              <div class="card-subtitle">${w.jobCategory || 'General'}</div>
              <div class="card-footer">
                <span class="card-rating"><i class="fas fa-star"></i> ${w.avgRating?.toFixed(1) || '5.0'}</span>
                <span>${w.status || 'Available'}</span>
              </div>
            </div>
          </div>
        `;
      });
      document.getElementById('browseGrid').innerHTML = html;
    }

    // -------------------- AUTH STATE LISTENER --------------------
    onAuthStateChanged(auth, (user) => {
      window.currentUser = user;
      if (user) {
        document.getElementById('authBtn').innerHTML = '<i class="fas fa-sign-out-alt"></i>';
        document.getElementById('authBtn').onclick = logout;
      } else {
        document.getElementById('authBtn').innerHTML = '<i class="fas fa-user"></i>';
        document.getElementById('authBtn').onclick = showAuthModal;
      }
      navigateTo('home');
    });

    window.logout = async () => {
      await signOut(auth);
      showToast('Logged out successfully');
    };

    // -------------------- INIT --------------------
    // Load initial data
    console.log('Kazi ni Kazi initialized');
  </script>
</body>
</html>
